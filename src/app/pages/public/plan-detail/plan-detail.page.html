<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <!-- Mantenemos defaultHref="/" para que siempre regrese al Landing o Home de invitado -->
      <ion-back-button defaultHref="/"></ion-back-button>
    </ion-buttons>
    <ion-title>Detalle del Plan</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="plan" class="ion-padding">
  <div class="ion-text-center">
    <img [src]="plan.imagen_url || 'assets/placeholder-plan.png'" style="border-radius: 15px; height: 200px; object-fit: cover;">
    <h1 color="primary">{{ plan.nombre }}</h1>
    <h2 class="price">{{ plan.precio | currency }}<small>/mes</small></h2>
  </div>

  <ion-list inset>
    <ion-item><ion-label><b>Datos:</b> {{ plan.datos }}</ion-label></ion-item>
    <ion-item><ion-label><b>Minutos:</b> {{ plan.minutos }}</ion-label></ion-item>
    <ion-item><ion-label><b>Velocidad:</b> {{ plan.velocidad }}</ion-label></ion-item>
    <ion-item><ion-label><b>Redes Sociales:</b> {{ plan.redes_sociales }}</ion-label></ion-item>
    <ion-item><ion-label><b>Roaming:</b> {{ plan.roaming }}</ion-label></ion-item>
  </ion-list>

  <div class="ion-padding">
    <p>{{ plan.descripcion }}</p>
  </div>

  <ion-footer class="ion-no-border">
    <ion-toolbar>
      <ion-button expand="block" (click)="contratar()" color="secondary">
        {{ isLoggedIn ? 'SOLICITAR CONTRATACIÓN' : 'INICIA SESIÓN PARA CONTRATAR' }}
      </ion-button>
      
      <!-- CORRECCIÓN CLAVE: Botón de catálogo lleva a la ruta de Invitado o al Home de Tabs -->
      <ion-button expand="block" [routerLink]="isLoggedIn ? ['/tabs/home'] : ['/guest-catalog']" fill="outline" color="primary">
        VER MÁS PLANES
      </ion-button>
    </ion-toolbar>
  </ion-footer>
</ion-content>